.\" -*- coding: UTF-8 -*-
'\" t
.\"*******************************************************************
.\"
.\" This file was generated with po4a. Translate the source file.
.\"
.\"*******************************************************************
.TH SYSTEMD\-DISSECT 1 "" "systemd 253" systemd\-dissect
.ie  \n(.g .ds Aq \(aq
.el       .ds Aq '
.\" -----------------------------------------------------------------
.\" * Define some portability stuff
.\" -----------------------------------------------------------------
.\" ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
.\" http://bugs.debian.org/507673
.\" http://lists.gnu.org/archive/html/groff/2009-02/msg00013.html
.\" ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
.\" -----------------------------------------------------------------
.\" * set default formatting
.\" -----------------------------------------------------------------
.\" disable hyphenation
.nh
.\" disable justification (adjust text to left margin only)
.ad l
.\" -----------------------------------------------------------------
.\" * MAIN CONTENT STARTS HERE *
.\" -----------------------------------------------------------------
.SH NAME
systemd\-dissect \- 剖析可发现的磁盘映像 (DDIs)
.SH SYNOPSIS
.HP \w'\fBsystemd\-dissect\ \fR\fB[OPTIONS...]\fR\fB\ \fR\fB\fIIMAGE\fR\fR\ 'u
\fBsystemd\-dissect \fP\fB[OPTIONS...]\fP\fB \fP\fIIMAGE\fP
.HP \w'\fBsystemd\-dissect\ \fR\fB[OPTIONS...]\fR\fB\ \fR\fB\fB\-\-mount\fR\fR\fB\ \fR\fB\fIIMAGE\fR\fR\fB\ \fR\fB\fIPATH\fR\fR\ 'u
\fBsystemd\-dissect \fP\fB[OPTIONS...]\fP\fB \fP\fB\-\-mount\fP\fB \fP\fIIMAGE\fP\fB \fP\fIPATH\fP
.HP \w'\fBsystemd\-dissect\ \fR\fB[OPTIONS...]\fR\fB\ \fR\fB\fB\-\-umount\fR\fR\fB\ \fR\fB\fIPATH\fR\fR\ 'u
\fBsystemd\-dissect \fP\fB[OPTIONS...]\fP\fB \fP\fB\-\-umount\fP\fB \fP\fIPATH\fP
.HP \w'\fBsystemd\-dissect\ \fR\fB[OPTIONS...]\fR\fB\ \fR\fB\fB\-\-list\fR\fR\fB\ \fR\fB\fIIMAGE\fR\fR\ 'u
\fBsystemd\-dissect \fP\fB[OPTIONS...]\fP\fB \fP\fB\-\-list\fP\fB \fP\fIIMAGE\fP
.HP \w'\fBsystemd\-dissect\ \fR\fB[OPTIONS...]\fR\fB\ \fR\fB\fB\-\-mtree\fR\fR\fB\ \fR\fB\fIIMAGE\fR\fR\ 'u
\fBsystemd\-dissect \fP\fB[OPTIONS...]\fP\fB \fP\fB\-\-mtree\fP\fB \fP\fIIMAGE\fP
.HP \w'\fBsystemd\-dissect\ \fR\fB[OPTIONS...]\fR\fB\ \fR\fB\fB\-\-with\fR\fR\fB\ \fR\fB\fIIMAGE\fR\fR\fB\ \fR\fB[\fICOMMAND\fR...]\fR\ 'u
\fBsystemd\-dissect \fP\fB[OPTIONS...]\fP\fB \fP\fB\-\-with\fP\fB \fP\fIIMAGE\fP\fB \fP\fB[\fP\fICOMMAND\fP...]
.HP \w'\fBsystemd\-dissect\ \fR\fB[OPTIONS...]\fR\fB\ \fR\fB\fB\-\-copy\-from\fR\fR\fB\ \fR\fB\fIIMAGE\fR\fR\fB\ \fR\fB\fIPATH\fR\fR\fB\ \fR\fB[\fITARGET\fR]\fR\ 'u
\fBsystemd\-dissect \fP\fB[OPTIONS...]\fP\fB \fP\fB\-\-copy\-from\fP\fB \fP\fIIMAGE\fP\fB \fP\fIPATH\fP\fB \fP\fB[\fP\fITARGET\fP]
.HP \w'\fBsystemd\-dissect\ \fR\fB[OPTIONS...]\fR\fB\ \fR\fB\fB\-\-copy\-to\fR\fR\fB\ \fR\fB\fIIMAGE\fR\fR\fB\ \fR\fB[\fISOURCE\fR]\fR\fB\ \fR\fB\fIPATH\fR\fR\ 'u
\fBsystemd\-dissect \fP\fB[OPTIONS...]\fP\fB \fP\fB\-\-copy\-to\fP\fB \fP\fIIMAGE\fP\fB \fP\fB[\fP\fISOURCE\fP]\fB \fP\fIPATH\fP
.SH DESCRIPTION
.PP
\fBsystemd\-dissect\fP 是一种用于自省文件系统操作系统磁盘映像并与之交互的工具，特别是可发现磁盘映像
(DDI)\&。它支持四种不同的操作:
.sp
.RS 4
.ie  n \{\
\h'-04' 1.\h'+01'\c
.\}
.el \{\
.sp -1
.IP "  1." 4.2
.\}
显示一般操作系统映像信息，包括映像 \*(Aqs \fBos\-release\fP(5) 数据、机器 ID、分区信息等 \&。
.RE
.sp
.RS 4
.ie  n \{\
\h'-04' 2.\h'+01'\c
.\}
.el \{\
.sp -1
.IP "  2." 4.2
.\}
将操作系统映像挂载到本地目录 \&。在这种模式下，它将剖析操作系统映像并根据它们的指定将包含的分区挂载到目录和可能的子目录 \&。
.RE
.sp
.RS 4
.ie  n \{\
\h'-04' 3.\h'+01'\c
.\}
.el \{\
.sp -1
.IP "  3." 4.2
.\}
从本地目录卸载操作系统映像 \&。在这种模式下，它将递归地卸载已挂载的分区并删除底层循环设备，包括所有分区子设备 \&。
.RE
.sp
.RS 4
.ie  n \{\
\h'-04' 4.\h'+01'\c
.\}
.el \{\
.sp -1
.IP "  4." 4.2
.\}
将文件和目录复制进出操作系统映像 \&。
.RE
.PP
该工具可以在三种类型的操作系统映像上运行:
.sp
.RS 4
.ie  n \{\
\h'-04' 1.\h'+01'\c
.\}
.el \{\
.sp -1
.IP "  1." 4.2
.\}
包含 GPT 分区表信封的 OS 磁盘映像，分区根据 \m[blue]\fBDiscoverable Partitions Specification\fP\m[]\&\s-2\u[1]\d\s+2\& 标记。
.RE
.sp
.RS 4
.ie  n \{\
\h'-04' 2.\h'+01'\c
.\}
.el \{\
.sp -1
.IP "  2." 4.2
.\}
OS 磁盘映像只包含一个没有封闭分区表的普通文件系统 \&。(假定此文件系统是 OS\& 的根文件系统。)
.RE
.sp
.RS 4
.ie  n \{\
\h'-04' 3.\h'+01'\c
.\}
.el \{\
.sp -1
.IP "  3." 4.2
.\}
包含 GPT 或 MBR 分区表的操作系统磁盘映像，只有一个分区 \&。(假定该分区包含 OS\& 的根文件系统。)
.RE
.PP
操作系统映像可以使用任何类型的 Linux 支持的文件系统 \&。此外，它们可能使用 LUKS 磁盘加密，并包含 Verity
完整性信息。请注意，符合条件的操作系统映像可以使用 \fBsystemd\-nspawn\fP(1)\*(Aqs \fB\-\-image=\fP 开关启动，并用作使用
\fIRootImage=\fP 元文件设置的系统服务的根文件系统，请参见 \fBsystemd.exec\fP(5)\&。
.PP
请注意，在不使用命令开关 (如下所列) 的情况下调用时显示的分区表不一定显示映像中包含的所有分区，而仅显示被理解并视为操作系统磁盘映像的一部分的分区
\&。具体来说，未知类型的分区以及重复分区 (i\&.e\&。每种分区类型不止一个) 以及与本地系统不兼容的体系结构的根和 /usr / 分区也是如此
\&。换句话说: 此工具将在安装图像时显示它所操作的内容 \&。要显示完整的分区列表，请使用 \fBfdisk\fP(8)\& 等工具。
.SH COMMANDS
.PP
如果下面列出的命令开关均未通过，则打开指定的磁盘映像，并显示有关映像和包含的分区及其使用的一般信息 \&。
.PP
\fB\-\-mount\fP, \fB\-m\fP
.RS 4
挂载指定操作系统镜像到指定目录 \&。这将剖析图像，确定操作系统根文件系统 \(em 以及可能的其他分区 \(em 并将它们安装到指定目录
\&。如果操作系统映像包含多个标有 \m[blue]\fBDiscoverable Partitions Specification\fP\m[]\&\s-2\u[1]\d\s+2 的分区，则会建立多个嵌套挂载 \&。此命令需要两个参数:
图像文件的路径和安装图像的目录路径 \&。
.sp
要卸载这样安装的操作系统映像，请使用 \fB\-\-umount\fP 操作 \&。
.sp
当操作系统映像包含 LUKS 加密或 Verity 完整性保护文件系统时，系统会自动设置适当的卷并标记为在卸载映像时自动反汇编 \&。
.sp
操作系统映像可以指定为存储在常规文件中的操作系统映像的路径，也可以引用块设备节点 (在后一种情况下，块设备必须是 "whole"
设备，i\&.e\&。不是分区设备) \&。(此处描述的其他受支持的命令也支持此 \&。)
.sp
所有挂载的文件系统都在自动修复模式下使用适当的 \fBfsck\fP(8) 实现进行检查，除非明确关闭 (\fB\-\-fsck=no\fP) 或请求
(\fB\-\-read\-only\fP)\& 的只读操作。
.RE
.PP
\fB\-M\fP
.RS 4
这是 \fB\-\-mount \-\-mkdir\fP\& 的快捷方式。
.RE
.PP
\fB\-\-umount\fP, \fB\-u\fP
.RS 4
从指定目录卸载操作系统映像 \&。此命令需要一个参数: 安装操作系统映像的目录 \&。
.sp
所有已挂载的分区将被递归卸载，底层循环设备将被删除，连同所有它 \*(Aqs partition sub\-devices\&。
.RE
.PP
\fB\-U\fP
.RS 4
这是 \fB\-\-umount \-\-rmdir\fP\& 的快捷方式。
.RE
.PP
\fB\-\-list\fP, \fB\-l\fP
.RS 4
将指定操作系统映像中所有文件和目录的路径打印到标准输出 \&。
.RE
.PP
\fB\-\-mtree\fP, \fB\-l\fP
.RS 4
生成指定磁盘映像的 BSD \fBmtree\fP(8) 兼容文件清单 \&。这对于详细比较磁盘映像内容很有用，包括 inode 信息和其他元数据
\&。虽然生成的清单将包含详细的 inode 信息，但它目前不包括扩展属性、文件系统功能、MAC 标签、\fBchattr\fP(1) 文件标志、btrfs
子卷信息和各种其他文件元数据。文件内容信息通过 SHA256 摘要显示。可能会在 future\& 中添加其他字段。请注意，链接计数、inode
编号和时间戳等 inode 信息是有意从输出中排除的，因为它通常会使再现性复杂化 \&。
.RE
.PP
\fB\-\-with\fP
.RS 4
使用指定的操作系统映像运行指定的命令 \&。这会将图像挂载到一个临时目录，将当前工作目录切换到它，并调用指定的命令行作为子进程
\&。一旦进程结束，它将再次卸载图像，并删除临时目录 \&。如果没有指定命令，则调用 shell\&。镜像挂载可写，使用 \fB\-\-read\-only\fP
切换为只读操作 \&。调用的进程将设置 \fI$SYSTEMD_DISSECT_ROOT\fP
环境变量，其中包含临时安装点的绝对路径名，i\&.e\&。设置为当前工作目录的同一目录 \&。
.RE
.PP
\fB\-\-copy\-from\fP, \fB\-x\fP
.RS 4
将指定操作系统映像中的文件或目录复制到主机文件系统上的指定位置 \&。需要三个参数: 一个图像文件的路径，一个源路径 (相对于图像 \* (Aqs
根目录) 和一个目标路径 (相对于当前工作目录，或者绝对路径，都在图像之外) \&. 如果省略目标路径或将目标路径指定为短划线
("\-")，则将指定的文件写入标准输出 \&。如果图像文件系统中的源路径引用常规文件，则将其复制到目标路径
\&。在这种情况下，访问模式、扩展属性和时间戳也被复制，但文件所有权不是
\&。如果图像中的源路径指的是目录，则将其复制到目标路径，递归地包含所有包含的文件和目录 \&。在这种情况下，文件所有权也被复制 \&。
.RE
.PP
\fB\-\-copy\-to\fP, \fB\-a\fP
.RS 4
将文件或目录从主机文件系统中的指定位置复制到指定的操作系统映像 \&。需要三个参数: 一个图像文件的路径，一个源路径
(相对于当前工作目录，或者绝对路径，都在图像之外) 和一个目标路径 (相对于图像 \*(Aqs 根目录)\&. 如果省略源路径或将其指定为破折号
("\-")，则从标准输入 \& 读取要写入的数据。如果主机文件系统中的源路径引用常规文件，则将其复制到目标路径
\&。在这种情况下，访问模式、扩展属性和时间戳也被复制，但文件所有权不是
\&。如果主机文件系统中的源路径引用一个目录，则将其复制到目标路径，递归地包含所有包含的文件和目录 \&。在这种情况下，文件所有权也被复制 \&。
.sp
与 \fB\-\-mount\fP 一样，文件系统检查在复制操作开始之前隐式运行 \&。
.RE
.PP
\fB\-\-discover\fP
.RS 4
显示知名目录中的 DDI 列表 \&。这将在常用目录
/usr/lib/machines/、/usr/lib/portables/、/usr/lib/extensions/、/var/lib/machines/、/var/lib/portables/、/var/lib/extensions/
等 \& 中显示机器、便携式服务和系统扩展磁盘映像。
.RE
.PP
\fB\-h\fP, \fB\-\-help\fP
.RS 4
打印一个简短的帮助文本并退出 \&。
.RE
.PP
\fB\-\-version\fP
.RS 4
打印一个短版本字符串并退出 \&。
.RE
.SH OPTIONS
.PP
理解以下选项:
.PP
\fB\-\-read\-only\fP, \fB\-r\fP
.RS 4
以只读模式运行 \&。默认情况下 \fB\-\-mount\fP 将建立可写挂载点 \&。如果指定了此选项，它们将以只读模式建立 \&。
.RE
.PP
\fB\-\-fsck=no\fP
.RS 4
关闭自动文件系统检查 \&。默认情况下，当访问映像进行写入时 (通过 \fB\-\-mount\fP 或
\fB\-\-copy\-to\fP)，操作系统映像中包含的文件系统会使用适当的 \fBfsck\fP(8) 命令自动检查，处于自动修复模式 \&。可以使用
\fB\-\-fsck=no\fP\& 关闭此行为。
.RE
.PP
\fB\-\-growfs=no\fP
.RS 4
如果在 GPT 分区表中标记为分区大小，则关闭访问的文件系统自动增长到它们的分区大小 \&。默认情况下，当访问映像进行写入时 (通过
\fB\-\-mount\fP 或 \fB\-\-copy\-to\fP)，操作系统映像中包含的文件系统会自动增长到它们的分区大小，如果 GPT 分区标志中的位 59
设置为由 \m[blue]\fBDiscoverable Partitions Specification\fP\m[]\&\s-2\u[1]\d\s+2\&. 可以使用 \fB\-\-growfs=no\fP\&
关闭此行为。如果满足以下所有条件，文件系统会在访问时自动增长:
.sp
.RS 4
.ie  n \{\
\h'-04' 1.\h'+01'\c
.\}
.el \{\
.sp -1
.IP "  1." 4.2
.\}
文件系统挂载为可写
.RE
.sp
.RS 4
.ie  n \{\
\h'-04' 2.\h'+01'\c
.\}
.el \{\
.sp -1
.IP "  2." 4.2
.\}
当前文件系统小于它所在的分区 (因此可以增长)
.RE
.sp
.RS 4
.ie  n \{\
\h'-04' 3.\h'+01'\c
.\}
.el \{\
.sp -1
.IP "  3." 4.2
.\}
该图像包含一个 GPT 分区表
.RE
.sp
.RS 4
.ie  n \{\
\h'-04' 4.\h'+01'\c
.\}
.el \{\
.sp -1
.IP "  4." 4.2
.\}
文件系统存储在可发现分区规范定义的分区上
.RE
.sp
.RS 4
.ie  n \{\
\h'-04' 5.\h'+01'\c
.\}
.el \{\
.sp -1
.IP "  5." 4.2
.\}
根据规范，此分区的 GPT 分区标志的第 59 位已设置
.RE
.sp
.RS 4
.ie  n \{\
\h'-04' 6.\h'+01'\c
.\}
.el \{\
.sp -1
.IP "  6." 4.2
.\}
\fB\-\-growfs=no\fP 选项未通过 \&。
.RE
.RE
.PP
\fB\-\-mkdir\fP
.RS 4
如果与 \fB\-\-mount\fP 结合使用，则在缺少 \& 时创建用于挂载 OS 映像的目录。请注意，再次卸载磁盘映像时，该目录不会自动删除 \&。
.RE
.PP
\fB\-\-rmdir\fP
.RS 4
如果与 \fB\-\-umount\fP 结合使用，则在卸载 OS 映像后删除安装 OS 映像的指定目录 \&。
.RE
.PP
\fB\-\-discard=\fP
.RS 4
采用 "disabled"、"loop"、"all"、`crypto`\& 之一。如果 "disabled" 在空块丢弃关闭的情况下访问图像
\&。如果在常规文件上操作时启用 "loop" 丢弃 \&。如果即使在加密文件系统上也启用了 "crypt" 丢弃 \&。如果无条件启用 "all"
丢弃 \&。
.RE
.PP
\fB\-\-in\-memory\fP
.RS 4
如果指定，则使用指定磁盘映像的内存副本 \&。这可用于对 (可能是只读的) 图像进行写访问操作，而无需实际修改原始文件
\&。这也可以用于在不保持原始文件系统繁忙的情况下对磁盘映像进行操作，以允许它被卸载 \&。
.RE
.PP
\fB\-\-root\-hash=\fP, \fB\-\-root\-hash\-sig=\fP, \fB\-\-verity\-data=\fP
.RS 4
为操作系统映像配置 Verity 数据完整性的各个方面。选项 \fB\-\-root\-hash=\fP 指定一个十六进制编码的顶级 Verity 散列，用于设置
Verity 完整性保护 \&。选项 \fB\-\-root\-hash\-sig=\fP 指定包含散列 \& 的 PKCS#7
签名的文件的路径。此签名在激活期间传递给内核，内核会将其与内核密钥环中可用的签名密钥进行匹配。选项 \fB\-\-verity\-data=\fP
指定一个文件的路径，该文件包含 Verity 数据以用于操作系统映像，以防它存储在分离的文件中 \&。建议使用
\m[blue]\fBDiscoverable Partitions Specification\fP\m[]\&\s-2\u[1]\d\s+2\& 中的
Verity 机制将 Verity 数据直接嵌入到图像中。
.RE
.PP
\fB\-\-no\-pager\fP
.RS 4
不要将输出通过管道传输到寻呼机 \&。
.RE
.PP
\fB\-\-no\-legend\fP
.RS 4
不要打印图例，i\&.e\&。带有提示的列标题和页脚 \&。
.RE
.PP
\fB\-\-json=\fP\fIMODE\fP
.RS 4
显示格式为 JSON\& 的输出。期望 "short" (用于尽可能短的输出，没有任何冗余空格或换行符)、"pretty"
(用于相同版本的漂亮版本，带有缩进和换行符) 或 "off" (关闭 JSON 输出，默认值) \&。
.RE
.SH "EXIT STATUS"
.PP
成功时返回 0，否则返回非零失败代码 \&。如果使用 \fB\-\-with\fP 命令，则传播调用命令的退出状态 \&。
.SH EXAMPLES
.PP
\fBExample\ \&1.\ \&Generate a tarball from an OS disk image\fP
.sp
.if  n \{\
.RS 4
.\}
.nf
$ systemd\-dissect \-\-with foo\&.raw tar cz \&. >foo\&.tar\&.gz
.fi
.if  n \{\
.RE
.\}
.SH "SEE ALSO"
.PP
\fBsystemd\fP(1), \fBsystemd\-nspawn\fP(1), \fBsystemd.exec\fP(5),
\m[blue]\fBDiscoverable Partitions Specification\fP\m[]\&\s-2\u[1]\d\s+2,
\fBumount\fP(8), \fBfdisk\fP(8)
.SH NOTES
.IP " 1." 4
可发现分区规范
.RS 4
\%https://uapi\-group.org/specifications/specs/discoverable_partitions_specification
.RE
.PP
.SH [手册页中文版]
.PP
本翻译为免费文档；阅读
.UR https://www.gnu.org/licenses/gpl-3.0.html
GNU 通用公共许可证第 3 版
.UE
或稍后的版权条款。因使用该翻译而造成的任何问题和损失完全由您承担。
.PP
该中文翻译由 wtklbm
.B <wtklbm@gmail.com>
根据个人学习需要制作。
.PP
项目地址:
.UR \fBhttps://github.com/wtklbm/manpages-chinese\fR
.ME 。
